(function(n){this.fonctionnaliteTooltipSticker=function(t,i,r){var o="templateToolTipStickerTexte",c="templateEnveloppeToolTipSticker";if(!t)throw"l' objet de templates est indéfini";if(!r)throw"la fonction de recupêration d'un element par son uuid doit etre défini";var s="data-tooltip2",e="["+s+"]",u={},f={},l=function(n){return _.where(i.lstStickers,{iIdSticker:parseInt(n)})[0]},h=function(t){if(!t)throw"la tooltip est indefinie";var i=t,e=function(t,i){var r=new n.Deferred;return setTimeout(function(){r.resolve(t)},i),r.promise()},r=function(n){var t=n.getElementDomAssocie();return i.sIdSticker+t.attr("id")},o=function(t,r,f){var o=i.render(),s=t.split("sId")[0],h=f.find("[data-idsticker="+s+"]"),e=n(o);h.after(e);u[t]=e},s=function(n){u[n].remove();u[n]=null},h=function(n){var r=n.getElementDomAssocie(),t=i.sIdSticker+r.attr("id");u[t]?u[t].show():o(t,n,r)},c=function(n){var t=r(n);f[t]<=0&&u[t]&&u[t].hide()},l=function(n){if(!n)throw"l'objet de donnéee est indéfini";var t=r(n);f[t]||(f[t]=0);f[t]++;u[t]&&f[t]==0&&s(t);e(n).done(h)},a=function(n){if(!n)throw"l'objet de donnéee est indéfini";var t=r(n);u[t]?f[t]--:f[t]=0;e(n).done(c)};return{show:l,hide:a}},a=function(i){i.on("mouseenter",e,function(i){var f,u;if(i.preventDefault(),i.stopPropagation(),f=r(i),u=n(this),u.attr("data-idsticker")){var e=u.attr("data-idsticker"),s=function(){var i=this.sIdSticker,n=l(i);o=n.sTooltipUrlImgCheminComplet?"templateToolTipStickerImage":"templateToolTipStickerTexte";var r="",s=u.attr("data-typesticker"),h="",e="";n.sTypeSticker==="BRD"?(r=Utilitaires.Ressources.vbNETsWCRS201.tooltipSticker.texteLienActionBRD,e=n.sUrlBRD):n.sTypeSticker==="NUTRIMARK"||n.sTypeSticker==="NUTRISCORE"?(r=Utilitaires.Ressources.vbNETsWCRS201.tooltipSticker.texteLienActionNutri,e=n.sUrlAideEnLigne):f.getElementDomAssocie().find(".divWCRS310_HD img").length>=2&&f.getElementDomAssocie().find(".divWCRS310_HD img :last").attr("data-idsticker")===i&&(h="spanWCRS310_AccocheBasse",n.sTypeSticker==="QUANTITE_MIN"&&(s+=" avecAccrocheBasse"));var a={sLibelle_1:n.sTooltipLibelle1,sLibelle_2:n.sTooltipLibelle2,texteLienAction:r,sUrlImageTooltipSticker:n.sTooltipUrlImgCheminComplet,sStickerAltText:n.sTexteAlternatif,sUrlRedirect:e,sAccrocheCssClass:h},v=t[o].ExecuteTemplate(a),y={sCssClass:s,sTypeTooltip:"StickerTexte",iIdSticker:i,sContenu:v},p=t[c];return p.ExecuteTemplate(y)},a={sIdSticker:e,sTypeTooltip:"StickerTexte",render:s};h(a,u).show(f)}});i.on("mouseleave",e,function(t){var u,f;t.preventDefault();t.stopPropagation();var o=n(this).attr(s),e=r(t),i=n(this);i.attr("data-idsticker")&&(u=i.attr("data-idsticker"),f={sIdSticker:u,sTypeTooltip:"StickerTexte",sContenu:""},h(f,i).hide(e))})},v=function(n){var t=this;n.off("mouseenter",e);n.off("mouseleave",e)};return{appliquerFonctionnalite:a,disposerFonctionnalite:v}};var u=Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient,i=function(n){var t=n;return{subscribe:function(n){var i=n;Managers.jsWCRS609_MgrEvenement.abonnerEvenement(t,i,this)},unsubscribe:function(n){var i=n;Managers.jsWCRS609_MgrEvenement.desabonnerEvenement(t,i,this)}}},r=Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur;this.fonctionnaliteTooltipEvenementsPanier=function(t,u){var o="data-typesticker",a="["+o+"]",f=u,e=function(t,i){var u=n($get(t)),f="["+o+"=BRD]",r=u.find(f);i==!0?r.addClass("StickerInvalide"):r.removeClass("StickerInvalide")},s=function(n){var t=f.where(function(t){return t.objElement.sIdUniqueBrd==n.sIdUnique});_.each(t,function(n){e(n.objElement.sUuid,!0)})},h=function(n){var t=f.where(function(t){return t.objElement.sIdUniqueBrd==n.sIdUnique});_.each(t,function(n){e(n.objElement.sUuid,!1)})},c=function(){var n=f.where(function(n){return n.objElement.fGainsBRD==!0});_.each(n,function(n){e(n.objElement.sUuid,!0)});i(r.iBRD_CONSOMME).subscribe(s);i(r.iBRD_NON_CONSOMME).subscribe(h)},l=function(){i(r.iBRD_CONSOMME).unsubscribe();i(r.iBRD_NON_CONSOMME).unsubscribe()};return{appliquerFonctionnalite:c,disposerFonctionnalite:l}};var t=function(n){if(!n)throw"le type de la tooltip est indéfini";var t=n;return function(n,i){if(!n)throw"l'objet template tooltip est indéfini";var r=n,u=i,f=function(n){var t=r.ExecuteTemplate(n);return t};return{sCssClass:u,sTypeTooltip:t,ExecuteTemplate:f}}},w=function(n){if(!n)throw"le type de la tooltip est indéfini";var t=n;return function(n,i,r){if(!n)throw"l'objet template tooltip est indéfini";var f=n,u=i,e=r,o=function(n){var i=f.ExecuteTemplate(n),t="";return u&&(t=u.ExecuteTemplate(n)),i+t};return{sCssClass:e,sTypeTooltip:t,ExecuteTemplate:o}}},b=function(){return function(n,t,i){if(!n)throw"l'objet template tooltip est indéfini";var r=n,e=t,u=i,f=function(n){return r.ExecuteTemplate(n)};return{sCssClass:u,sTypeTooltip:_sTypeTooltip,ExecuteTemplate:f}}},e=t("AcheterUnLot"),o=t("ComposerUnLot"),s=t("EcoParticipation"),h=t("ProduitArreteAideTexte"),c=t("QteMax"),l=t("QteMaxPanier"),a=t("Origine"),k=t("StickerTexte"),d=t("StickerImage"),v=function(n){if(!n)throw"l'objet de template de la factory de tooltip est indéfini!";var t=n,i=function(n,i){if(!n)throw"le builder de tooltype a besoin d'un contenu de tooltip";var r=n,u=i,f=function(n){if(!n)throw"la fonction d'ouverture d'une tooltipContent prend en argument un objet de donnée";var i=r.ExecuteTemplate(n),f={sCssClass:r.sCssClass,sTypeTooltip:r.sTypeTooltip+u,sContenu:i};return t.ExecuteTemplate(f)};return{sTypeTooltip:r.sTypeTooltip,render:f}};return{createToolTip:i}},y=function(t,i,r,u,f,e){if(!t)throw"la tooltip est indefinie";var l=t,v=r,tt=i,o={},s={},c=f,y=e,a=function(t,i,r){var u=new n.Deferred;return setTimeout(function(){u.resolve(t,i)},r),u.promise()},h=function(t,i){var r=t.getElementDomAssocie();return r.attr("id")+l.sTypeTooltip+n(i).closest(y).length},p=function(t,i,r){var f=l.render(i),u=i.getElementDomAssocie();r&&c&&(u=n(r).find(c),u.length==0&&(u=n(r).closest(c)),u.length==0&&(u=n(r)));u.append(f);o[t]=u.children().last()},w=function(n){o[n].remove();o[n]=null},b=function(n,t){var r=n.getElementDomAssocie(),i=h(n,t);o[i]?o[i].show():p(i,n,t)},k=function(n,t){var i=h(n,t);s[i]<=0&&o[i]&&o[i].hide()},d=function(n,t){var u,r;if(!n)throw"l'objet de donnéee est indéfini";(u=t,i(n))&&(r=h(n,t),s[r]=1,v&&o[r]&&s[r]==0&&w(r),a(n,t).done(b))},g=function(n,t){if(!n)throw"l'objet de donnéee est indéfini";if(i(n.objElement)){var r=h(n,t);s[r]=0;a(n,t).done(k)}},nt=function(){o={};s={}};return u(nt),{show:d,hide:g}},f=function(t){t||Utl.Log.logError("140819095843 l'objet de template est indéfini");var ut=t,f={},p=new v(t.templateEnveloppeToolTip),r=function(t){var r=n.extend({dataToolTip:"",fnPredicatAffichage:function(){return!0},onDomReloaded:function(n){i(u.iFILTRES_TRI_PRODUITS_APPLIQUEES).subscribe(n);i(u.iRESIZE_LISTEPRODUIT).subscribe(n);i(u.iPRODUIT_HABITUEL_SUPPRIME).subscribe(n)}},t),e=p.createToolTip(r.tooltip,r.dataToolTip);f[r.sTypeTooltip+r.dataToolTip]=new y(e,r.fnPredicatAffichage,r.fForceReload,r.onDomReloaded,r.selecteurConteneurTooltip,r.selecteurSecondaire)},w=function(){var n=new s(t.templateTooltipEcoParticpation,"divWCRS310_TooltipEcoPart");return r({sTypeTooltip:n.sTypeTooltip,tooltip:n,dataToolTip:"",fForceReload:!1}),this},b=function(){var n=new e(t.templateTooltipAcheterUnLot,"divWCRS310_TooltipAcheterLot");return r({sTypeTooltip:n.sTypeTooltip,tooltip:n,dataToolTip:"",fForceReload:!1}),this},k=function(){var n=new o(t.templateTooltipComposerUnLot,"divWCRS310_TooltipAcheterLot");return r({sTypeTooltip:n.sTypeTooltip,tooltip:n,dataToolTip:"",fForceReload:!1}),this},d=function(){var n=new h(t.templateTooltipPourLigneArticleArrete);return r({sTypeTooltip:n.sTypeTooltip,tooltip:n,dataToolTip:"",fForceReload:!1}),this},g=function(n){var u,f,e="divWCRS310_TooltipQteMax",i;return n&&n.selecteurConteneurQteMax&&(u=n.selecteurConteneurQteMax),n&&n.selecteurResponsive&&(f=n.selecteurResponsive),n&&n.sCssTooltipQteMax&&(e=n.sCssTooltipQteMax),i=new c(t.templateTooltipQteMax,e),r({sTypeTooltip:i.sTypeTooltip,tooltip:i,dataToolTip:"",fForceReload:!0,selecteurConteneurTooltip:u,selecteurSecondaire:f}),this},nt=function(n){var u,f="divWCRS310_TooltipQteMax",e,i;return n&&n.selecteurConteneurQteMaxPanier&&(u=n.selecteurConteneurQteMaxPanier),n&&n.selecteurResponsive&&(e=n.selecteurResponsive),n&&n.sCssTooltipQteMaxPanier&&(f=n.sCssTooltipQteMaxPanier),i=new l(t.templateTooltipQteMaxPanier,f),r({sTypeTooltip:i.sTypeTooltip,tooltip:i,dataToolTip:"",fForceReload:!0,selecteurConteneurTooltip:u,selecteurSecondaire:e}),this},tt=function(){var n=new a(t.templateTooltipOrigine,"divWCRS310_TooltipOrigine");return r({sTypeTooltip:n.sTypeTooltip,tooltip:n,dataToolTip:"",fForceReload:!1}),this},it=function(n,t,i){if(!n)throw"le type de tooltip à afficher est indéfini";if(!t)throw"l'objet de données à afficher est indefini";var r=n;if(!f[r])throw"le type de tooltip à afficher est inconnu";f[r].show(t,i)},rt=function(n,t,i){if(!n)throw"le type de tooltip à afficher est indéfini";if(!t)throw"l'objet de données est indefini";var u=t,r=n;if(!f[r])throw"le type de tooltip à cacher est inconnu";f[r].hide(t,i)};return{avecEcoParticipation:w,avecAcheterUnLot:b,avecComposerUnLot:k,avecAideProduitArrete:d,avecQteMax:g,avecQteMaxPanier:nt,avecTooltipOrigine:tt,show:it,hide:rt}},p=function(t,i,r,u){if(!t)throw"l' objet de templates est indéfini";if(!i)throw"la fonction de recupêration d'un element par son uuid doit etre défini";if(!u)throw"l' objet de localisation est indéfini";var l=t,s=u,o=i,e="data-tooltip",f="["+e+"]",h=function(t){var i=this;t.on("mouseenter",f,function(t){t.preventDefault();t.stopPropagation();var f=n(this).attr(e),i=o(t),u=new Interfaces.ItfElementProduit(i.sUuid,i.objElement,"","",s);u.getElementDomAssocie=i.getElementDomAssocie;r.show(f,u,t.target)});t.on("click",f,function(t){t.preventDefault();t.stopPropagation();var f=n(this).attr(e),i=o(t),u=new Interfaces.ItfElementProduit(i.sUuid,i.objElement,"","",s);u.getElementDomAssocie=i.getElementDomAssocie;r.show(f,u,t.target)});t.on("mouseleave",f,function(t){t.preventDefault();t.stopPropagation();var i=n(this).attr(e),u=o(t);r.hide(i,u,t.target)})},c=function(n){var t=this;n.off("mouseenter",f);n.off("click",f);n.off("mouseleave",f)};return{appliquerFonctionnalite:h,disposerFonctionnalite:c}};this.affichageToolTip=function(){var t,i,r,n,u=function(n){return t=n,this},e=function(n){return i=n,this},o=function(n){return r=n,this},s=function(i){return n||(n=new f(t)),n.avecEcoParticipation().avecAcheterUnLot().avecComposerUnLot().avecQteMax(i).avecQteMaxPanier(i).avecTooltipOrigine(),this},h=function(){return n||(n=new f(t)),n.avecAideProduitArrete(),this},c=function(){return new p(t,i,n,r)},l={templates:u,fnGetContenuElementParEvenement:e,localisation:o};return{init:l,avecTooltipVignetteProduit:s,avecTooltipAideProduitArrete:h,build:c}}}).call(this.ListesProduits_Fonctionnalite=this.ListesProduits_Fonctionnalite||{__namespace:!0},window.jQuery);typeof Sys!="undefined"&&Sys.Application.notifyScriptLoaded();