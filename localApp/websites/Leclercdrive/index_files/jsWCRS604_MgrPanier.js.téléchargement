(function(n){this.jsWCRS604_MgrPanier=Utilitaires.Class.extend({objContexteProvenanceArticle:null,init:function(){}});this.jsWCRS604_MgrPanier.Evenements={onListeProduitshabituelsVides:new Utilitaires.pubsub.event("Managers.jsWCRS604_MgrPanier.Evenements.onListeProduitshabituelsVides")};this.jsWCRS604_MgrPanier.pCompleterProvenanceTestsAB=function(t){var i,r,u;return t&&(i=Managers.jsWCSD601_MgrTestsAB.RecupererInformationsProvenance(),i||i.length>0)?(r=i,t.sInformationsComplementaires&&t.sInformationsComplementaires.length>0&&(r=t.sInformationsComplementaires+";"+i),u=n.extend({},t),u.sInformationsComplementaires=r,u):t};this.jsWCRS604_MgrPanier.enuTypeAction={iINCREMENTATION_QTE:1,iDECREMENTATION_QTE:2};this.jsWCRS604_MgrPanier.enuOperationHandlerPanier={iMODIFIER_QUANTITE_COMMANDEE:1,iAJOUTER_LOT:2,iRECUPERER_PANIER:12};this.jsWCRS604_MgrPanier.emettreProduitsHabituelsVides=function(){Managers.jsWCRS604_MgrPanier.Evenements.onListeProduitshabituelsVides.trigger()};this.jsWCRS604_MgrPanier.souscrireProduitsHabituelsVides=function(n,t){Managers.jsWCRS604_MgrPanier.Evenements.onListeProduitshabituelsVides.on(n,t)};this.jsWCRS604_MgrPanier.RecuperationFicheProduit=function(t,i){var r=n.Deferred();return Utilitaires.Ajax.appeler({config:window.lstConfAjax.FicheProduit,data:{iIdProduit:t,sNoPointLivraison:i},enqueue:!0}).done(function(n){r.resolve(n)}).fail(function(){r.reject()}),r.promise()};this.jsWCRS604_MgrPanier.ModifierQuantiteCommandee=function(t){var u=n.Deferred(),f,i,r;return t&&(f=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_DEMANDEE),Managers.jsWCRS609_MgrEvenement.emettreEvenement(f),i=Managers.jsWCRS604_MgrPanier.pCompleterProvenanceTestsAB(t.objProvenanceArticle),r=n("#"+t.sUuidEmetteur).parent("ul"),r&&r.length&&i&&window.TradeGeneriqueContext&&r[0].className=="ulWMKP001_TradeGen"&&window.TradeGeneriqueContext.paramInsertionLevier&&i.sInformationsComplementaires.indexOf("sto-")<0&&(i.sInformationsComplementaires+=";sto-"+window.TradeGeneriqueContext.paramInsertionLevier.sIdOperation),Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.ModifierQuantiteCommandee,operation:{id:"ModifQte".concat(t.iIdProduit),unique:!0,silent:!0},data:{eTypeAction:t.eTypeAction,iIdProduit:t.iIdProduit,iQuantite:t.iQuantite,sNoPointLivraison:t.sNoPointLivraison,objContexteProvenanceArticle:i},enqueue:!0}).done(function(n,i){var r,f,e;if(n)for(r=0,f=n.length,r;r<f;r++)i&&(n[r].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT_RISQUE||n[r].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT)&&i.annulerOperation(),n[r].sUuidEmetteur=t.sUuidEmetteur,Managers.jsWCRS609_MgrEvenement.emettreEvenement(n[r]);e=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(e);u.resolveWith(t.objContexte,null)}).fail(function(n){var i,t;if(n!=Utilitaires.Constantes.Ajax.Erreur.iOPERATION_ANNULEE){u.rejectWith(n);i=null;try{n.status&&(i=n.status)}catch(r){}t=null;try{n.responseText&&(t=JSON.stringify(n.responseText))}catch(r){}if(!t)try{t=JSON.stringify(n)}catch(r){}t||(t=n);i&&(t=i+" - "+t);Utl.Log.logError("140814042351 - Une erreur s'est produite lors de l'appel au handler modifier quantité commandée : "+t)}})),u.promise()};this.jsWCRS604_MgrPanier.ModifierQuantiteProduitAComposer=function(t){var i=n.Deferred(),r,u;return t&&(r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_DEMANDEE),Managers.jsWCRS609_MgrEvenement.emettreEvenement(r),u=Managers.jsWCRS604_MgrPanier.pCompleterProvenanceTestsAB(t.objProvenanceArticle),Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.ModifierQuantiteProduitAComposer,operation:{id:"ModifQte".concat(t.iIdProduit),unique:!0,silent:!0},data:{eTypeAction:t.eTypeAction,iIdProduit:t.iIdProduit,iQuantite:t.iQuantite,sNoPointLivraison:t.sNoPointLivraison,objContexteProvenanceArticle:u,lstListeLignesArticles:t.lstListeLignesArticles,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(n,r){var u,f,e;if(n)for(u=0,f=n.length,u;u<f;u++)r&&(n[u].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT_RISQUE||n[u].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT)&&r.annulerOperation(),n[u].sUuidEmetteur=t.sUuidEmetteur,Managers.jsWCRS609_MgrEvenement.emettreEvenement(n[u]);e=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(e);i.resolveWith(t.objContexte,null)}).fail(function(n){var r,t;if(n!=Utilitaires.Constantes.Ajax.Erreur.iOPERATION_ANNULEE){i.rejectWith(n);r=null;try{n.status&&(r=n.status)}catch(u){}t=null;try{n.responseText&&(t=JSON.stringify(n.responseText))}catch(u){}if(!t)try{t=JSON.stringify(n)}catch(u){}t||(t=n);r&&(t=r+" - "+t);Utl.Log.logError("170102024151 - Une erreur s'est produite lors de l'appel au handler modifier quantité produit à composer : "+t)}})),i.promise()};this.jsWCRS604_MgrPanier.AjouterLotHomogene=function(t){var i=n.Deferred(),r,u;return t&&(r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_DEMANDEE),Managers.jsWCRS609_MgrEvenement.emettreEvenement(r),u=Managers.jsWCRS604_MgrPanier.pCompleterProvenanceTestsAB(t.objProvenanceArticle),Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.AjouterLotHomogene,operation:{id:"ModifQte".concat(t.sId),unique:!0,silent:!0},data:{sNoPointLivraison:t.sNoPointLivraison,iIdProduit:t.sId,objContexteProvenanceArticle:u,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(n,r){var u,f,e;if(n)for(u=0,f=n.length,u;u<f;u++)r&&(n[u].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT_RISQUE||n[u].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT)&&r.annulerOperation(),Managers.jsWCRS609_MgrEvenement.emettreEvenement(n[u]);e=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(e);i.resolveWith(t.objContexte,null)}).fail(function(n){n!=Utilitaires.Constantes.Ajax.Erreur.iOPERATION_ANNULEE&&(i.rejectWith(n),Utl.Log.logError("140814043554 - Une erreur s'est produite de lors l'appel au handler ajouter lot homogene : "+n))})),i.promise()};this.jsWCRS604_MgrPanier.ComposerLotHeterogene=function(t){var i=n.Deferred();return t&&Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.ComposerLotHeterogene,data:{sCodeLotHeterogene:t.sCodeLotHeterogene,niIdProduit:t.niIdProduit,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(n){i.resolveWith(t.objContexte,[n,t.sCodeLotHeterogene])}).fail(function(n){i.rejectWith(n);Utl.Log.logError("140814043722 - Une erreur s'est produite lors de l'appel au handler composer lot heterogene: "+n)}),i.promise()};this.jsWCRS604_MgrPanier.PopinProduitsIngredientRecette=function(t){var i=n.Deferred();return t&&Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.PopinProduitsIngredients,data:{iIdProduit:t.iIdProduit,iIdRecette:t.iIdRecette,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(n){i.resolveWith(t.objContexte,[n])}).fail(function(n){i.rejectWith(n);Utl.Log.logError("140814043722 - Une erreur s'est produite lors de l'appel au handler PopinProduitsIngredientRecette: "+n)}),i.promise()};this.jsWCRS604_MgrPanier.ViderPanier=function(t){var i=n.Deferred(),r;return t&&(r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_DEMANDEE),Managers.jsWCRS609_MgrEvenement.emettreEvenement(r),Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.ViderPanier,enqueue:!0,data:{sNoPointLivraison:t.sNoPointLivraison}}).done(function(n){var r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(r);i.resolveWith(t.objContexte,[n])}).fail(function(n){i.rejectWith(t.objContexte);Utl.Log.logError("140814043835 - Une erreur s'est produite lors de l'appel au handler vider panier : "+n)})),i.promise()};this.jsWCRS604_MgrPanier.AdapterQteProduitsIndisponibles=function(){var t=n.Deferred();return Utilitaires.Ajax.appeler({config:window.lstConfAjax.AdapterQteProduitsIndisponibles,enqueue:!0}).done(function(n){var r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_DEMANDEE),i,u;if(Managers.jsWCRS609_MgrEvenement.emettreEvenement(r),n)for(i=0,u=n.length,i;i<u;i++)Managers.jsWCRS609_MgrEvenement.emettreEvenement(n[i]);r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(r);t.resolveWith()}).fail(function(n){t.rejectWith(n);Utl.Log.logError("140814043838 - Une erreur s'est produite lors de l'appel au handler AdapterQteProduitsIndisponibles : "+n)}),t.promise()};this.jsWCRS604_MgrPanier.ChangerDateRetrait=function(t){var i=n.Deferred(),r;return t&&(r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_DEMANDEE),Managers.jsWCRS609_MgrEvenement.emettreEvenement(r),Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.ChangerDateRetrait,data:{dateHeureRetrait:t.dateHeureRetrait,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(n){var t,r,u;if(n)for(t=0,r=n.length,t;t<r;t++)Managers.jsWCRS609_MgrEvenement.emettreEvenement(n[t]);u=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(u);i.resolveWith()}).fail(function(n){i.rejectWith(n);Utl.Log.logError("140814044002 - Une erreur s'est produite lors de l'appel au handler ChangerDateRetrait : "+n)})),i.promise()};this.jsWCRS604_MgrPanier.AdapterQteProduitIndisponible=function(t){var i=n.Deferred(),r;return t&&(r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_DEMANDEE),Managers.jsWCRS609_MgrEvenement.emettreEvenement(r),Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.AdapterQteProduitIndisponible,data:{iIdProduit:t.iIdproduit,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(n){var t,r,u;if(n)for(t=0,r=n.length,t;t<r;t++)Managers.jsWCRS609_MgrEvenement.emettreEvenement(n[t]);u=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(u);i.resolveWith()}).fail(function(n){i.rejectWith(n);Utl.Log.logError("140814044002 - Une erreur s'est produite lors de l'appel au handler AdapterQteProduitIndisponible : "+n)})),i.promise()};this.jsWCRS604_MgrPanier.RecupererProduitSubstitution=function(t){var i=n.Deferred();return t&&Utilitaires.Ajax.appeler({config:window.lstConfAjax.RecupererProduitsSubstitutions,data:{iIdProduit:t.iIdProduit,sNoPointLivraison:t.sNoPointLivraison,eTypePage:t.eTypePage},enqueue:!0}).done(function(n){i.resolveWith(t.objContexte,[n])}).fail(function(n){Utl.Log.logError("140814044741 - Une erreur s'est produite lors de l'appel au handler de recuperation des produits de substitutions : ");i.rejectWith(n)}),i.promise()};this.jsWCRS604_MgrPanier.EnregistrerRetraitApprox=function(t){var i=n.Deferred();return t&&Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.EnregistrerRetraitPanierApprox,data:{fPlusTard:t.fPlusTard,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(){i.resolveWith(t.objContexte)}).fail(function(n){i.rejectWith(n);Utl.Log.logError("140814044737 - Une erreur s'est produite lors de l'appel au handler EnregistrerRetraitPanierApprox : "+n)}),i.promise()};this.jsWCRS604_MgrPanier.AjoutListeDansPanier=function(t){var i=n.Deferred(),r;return t&&(r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_DEMANDEE),Managers.jsWCRS609_MgrEvenement.emettreEvenement(r),Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.AjouterListeDansPanier,data:{iIdListe:t.iIdListe,sNoPointLivraison:t.sNoPointLivraison,iTypeListe:t.iTypeListe,iIdUnivers:t.iUnivers,fSupprimerListe:t.fSupprimerListe},enqueue:!0}).done(function(){var n=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(n);i.resolve()}).fail(function(n){i.rejectWith(n);Utl.Log.logError("140814044836 - Une erreur s'est produite lors de l'appel au handler AjouterListeDansPanier : "+n)})),i.promise()};this.jsWCRS604_MgrPanier.SupprimerProduitHabituel=function(t){var i=n.Deferred();return t&&Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.SupprimerProduitHabituel,data:{iIdProduit:t.iIdProduit,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(){i.resolve()}).fail(function(n){i.rejectWith(n);Utl.Log.logError("140814045113 - Une erreur s'est produite lors de l'appel au handler de suppression de produit habituel: "+JSON.stringify(n))}),i.promise()};this.jsWCRS604_MgrPanier.AjoutCommandeDansPanier=function(t){var i=n.Deferred();return t?Utilitaires.Ajax.appeler({config:window.lstConfAjax.AjouterCommandeDansPanier,data:{iIdCommande:t.iIdCommande,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}):i.reject()};this.jsWCRS604_MgrPanier.AjouteProduitCrossUnitaire=function(t){var i=n.Deferred(),r,u;return t&&(r=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_DEMANDEE),Managers.jsWCRS609_MgrEvenement.emettreEvenement(r),u=Managers.jsWCRS604_MgrPanier.pCompleterProvenanceTestsAB(t.objProvenanceArti),Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.AjouterProduitCrossUnitaire,operation:{id:"ModifQte".concat(t.iIdProduitCross),unique:!0,silent:!0},data:{iIdProduitSource:t.iIdProduitSource,iIdProduitCross:t.iIdProduitCross,objContexteProvenanceArticle:u,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(n,r){var s;if(n){var u=0,f=null,o=null,e=null;for(iNbEvenements=n.length,u;u<iNbEvenements;u++){f=null;o=null;e=null;r&&(n[u].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT_RISQUE||n[u].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT)&&r.annulerOperation();switch(n[u].eTypeEvenement){case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_AJOUTE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_QUANTITE_INCREMENTEE:o=n[u].sIdUniqueRayon==t.objContenuCross.lstEnfants[0].objElement.sIdUniqueRayon?Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iCROSS_UNITAIRE_AJOUTE_PRODUIT_MEME_RAYON:Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iCROSS_UNITAIRE_AJOUTE_PRODUIT;break;case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_HETEROGENE_AJOUTE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_HETEROGENE_QUANTITE_INCREMENTEE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_HOMOGENE_AJOUTE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_HOMOGENE_QUANTITE_INCREMENTEE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_UNITAIRE_QUANTITE_INCREMENTEE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_UNITAIRE_AJOUTE:o=n[u].sIdUniqueRayon==t.objContenuCross.lstEnfants[0].objElement.sIdUniqueRayon?Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iCROSS_UNITAIRE_AJOUTE_LOT_MEME_RAYON:Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iCROSS_UNITAIRE_AJOUTE_LOT;break;default:f=n[u]}o?(e={},e.objElement=n[u].objElement,e.iIdProduitSource=t.iIdProduitSource,e.iIdProduitCross=t.iIdProduitCross,f=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(o).avecIdUnique(n[u].sIdUnique).avecElement(e)):f.eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iRAYON_AJOUTE&&(f.objElement.iIdProduitSource=t.iIdProduitSource,f.objElement.iIdProduitCross=t.iIdProduitCross);Managers.jsWCRS609_MgrEvenement.emettreEvenement(f)}}s=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(s);i.resolveWith(t.objContexte,null)}).fail(function(n){n!=Utilitaires.Constantes.Ajax.Erreur.iOPERATION_ANNULEE&&(i.rejectWith(n),Utl.Log.logError("141229055608 - Une erreur s'est produite lors de l'appel au handler modifier quantité commandée pour l'ajout d'un produit cross : "+n))})),i.promise()};this.jsWCRS604_MgrPanier.RemplacerProduitParUpUnitaire=function(t){var i=n.Deferred(),r;return t&&(r=Managers.jsWCRS604_MgrPanier.pCompleterProvenanceTestsAB(t.objProvenanceArticleUp),Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.RemplacerProduitUpUnitaire,operation:{id:"ModifQte".concat(t.iIdProduitSource),unique:!0,silent:!0},data:{iIdProduitSource:t.iIdProduitSource,iQuantiteSource:t.iQuantiteSource,iIdProduitUp:t.iIdProduitUp,iQuantiteUp:t.iQuantiteUp,objContexteProvenanceArticle:r,sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(n,r){var s;if(n){var u=0,h=n.length,o=null,e=null,f=null;for(u;u<h;u++){o=null;e=null;f=null;r&&(n[u].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT_RISQUE||n[u].eTypeEvenement==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_STOCK_INSUFFISANT)&&r.annulerOperation();n[u].sUuidEmetteur=t.sUuidEmetteur;switch(n[u].eTypeEvenement){case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_AJOUTE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iPRODUIT_QUANTITE_INCREMENTEE:e=Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iUP_UNITAIRE_REMPLACE_PRODUIT;break;case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_HETEROGENE_AJOUTE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_HETEROGENE_QUANTITE_INCREMENTEE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_HOMOGENE_AJOUTE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_HOMOGENE_QUANTITE_INCREMENTEE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_UNITAIRE_QUANTITE_INCREMENTEE:case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iBRII_UNITAIRE_AJOUTE:e=Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iUP_UNITAIRE_REMPLACE_LOT;break;case Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementServeur.iRAYON_AJOUTE:e=Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iUP_UNITAIRE_RAYON_MISE_A_JOUR;break;default:o=n[u]}e&&(e==Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iUP_UNITAIRE_RAYON_MISE_A_JOUR?(f={},f.sIdUniqueRayon=n[u].objElement.sIdUnique,f.iQteUp=t.iQuantiteUp):(f={},f.objElement=n[u].objElement,f.iIdProduitSource=t.iIdProduitSource,f.iIdProduitUp=t.iIdProduitUp),o=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(e).avecIdUnique(n[u].sIdUnique).avecElement(f));Managers.jsWCRS609_MgrEvenement.emettreEvenement(o)}}s=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iMODIFICATION_PANIER_EFFECTUEE);Managers.jsWCRS609_MgrEvenement.emettreEvenement(s);i.resolveWith(t.objContexte,null)}).fail(function(n){n!=Utilitaires.Constantes.Ajax.Erreur.iOPERATION_ANNULEE&&(i.rejectWith(n),Utl.Log.logError("141229055648 - Une erreur s'est produite lors de l'appel au handler Remplacer Produit Up Unitaire : "+n))})),i.promise()};this.jsWCRS604_MgrPanier.EnumTypeOperationCartoucheMemo={ajouter:"AjouterLigneMemo",modifier:"ModifierLigneMemo",supprimer:"SupprimerLigneMemo"};this.jsWCRS604_MgrPanier.GererAjaxValidationExpressionMemo=function(t){var i=n.Deferred();return Managers.jsWRSL602_MgrMemo.validerExpressionMemo(t).done(function(n){i.resolve(n)}).fail(function(n){Utl.Log.logError("141147348969 - Une erreur s'est produite lors de l'appel au WS de validation d'une expression memo : "+n)}),i.promise()};this.jsWCRS604_MgrPanier.GererAjaxMemo=function(t){var i=n.Deferred();return Managers.jsWRSL602_MgrMemo.gererAjaxMemo(t).done(function(n){i.resolve(n)}).fail(function(n){Utl.Log.logError("141147963159 - Une erreur s'est produite lors de l'appel au handler modifier memo : "+n)}),i.promise()};this.jsWCRS604_MgrPanier.supprimerPropositionTradeMarketing=function(t){var r=n.Deferred(),i;return t&&(Utilitaires.Ajax.appeler({context:t.objContexte,config:window.lstConfAjax.SupprimerCrossUp,data:{sNoPointLivraison:t.sNoPointLivraison,iIdProduitSource:t.iIdProduitSource,iIdProduitCrossUp:t.iIdProduitCross},enqueue:!0}),i=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iCROSS_UP_UNITAIRE_SUPPRIME).avecElement(t.objContenuTrade),Managers.jsWCRS609_MgrEvenement.emettreEvenement(i)),r.promise()};this.jsWCRS604_MgrPanier.RecupererResultatRechercheAjax=function(t){var i=n.Deferred(),r;return t&&(r=Utl.Loader.afficher(),Utilitaires.Ajax.appeler({config:t,enqueue:!1}).done(function(n){Managers.jsWCRS609_MgrEvenement.emettreEvenement(Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iDATASOURCE_PAGE_RECHERCHE_MODIFIE).avecElement(n));r.masquer()}).fail(function(n){Utl.Log.logError("150807115057 - Une erreur s'est produite lors de l'appel au handler de recuperation du resultat de la recherche ! ");i.rejectWith(n)})),i.promise()};this.jsWCRS604_MgrPanier.RecupererInformationsPaniers=function(t){var i=n.Deferred(),r;return t&&t.sNoPointLivraison?Utilitaires.Ajax.appeler({config:window.lstConfAjax.RecupererInformationsPaniers,data:{sNoPointLivraison:t.sNoPointLivraison},enqueue:!0}).done(function(n){i.resolveWith(t.objContexte,[n])}).fail(function(n){i.rejectWith(n);Utl.Log.logError("180212014958 - Une erreur s'est produite lors de l'appel au handler panier : "+n)}):(r="180212015202 - Le numéro du point de livraison n'est pas renseigné",i.rejectWith(r),Utl.Log.logError(r)),i.promise()};this.jsWCRS604_MgrPanier.RecupererNombreProduitsPanier=function(t){var i=n.Deferred();return Managers.jsWCRS604_MgrPanier.RecupererInformationsPaniers(t).done(function(n){var r=0;n.forEach(function(n){var t=n.objElement;t&&(r+=t.lstProduitsLight.length)});i.resolveWith(t.objContexte,[r])}),i.promise()}}).call(this.Managers=this.Managers||{__namespace:!0},window.jQuery);typeof Sys!="undefined"&&Sys.Application.notifyScriptLoaded();