(function(n){function s(){for(var n=0;n<WCRS341_AjoutDansListe.lstListeClient.length;n++)if(WCRS341_AjoutDansListe.lstListeClient[n].fModifEffectuee)return!0;return!1}function u(n){var t=n.element.find(".liWCRS341_BtnValider .WCTD_boutonBleu");n.options.fValiderEnabled==!1?(t.addClass("WCTD_disabled"),WCRS341_AjoutDansListe.fValiderEnabled=!1):n.options.fValiderEnabled==!0&&t.is(".WCTD_disabled")&&(t.removeClass("WCTD_disabled"),WCRS341_AjoutDansListe.fValiderEnabled=!0)}function h(i){i.element.find(".aWCRS341_ToggleCreation").click(function(){return c(this,i.element)});i.element.find(".ulWCRS341_Listes").click(function(r){l(r,i);var u=n(r.target).closest("li").find("input").val();t.indexOf(u)<0?t.push(u):t.splice(t.indexOf(u),1)});i.element.find(".divWCRS341_Creation .WCTD_boutonBleu").click(function(n){a(n,i)});i.element.find("[id$=_tbCreerListe]").keydown(function(n){(n.keyCode==13||n.keyCode==3)&&i.element.find(".divWCRS341_Creation .WCTD_boutonBleu").click()});i.element.find(".liWCRS341_BtnValider .WCTD_boutonBleu").click(function(){return y(i)})}function c(t,i){return n(t).css("display","none"),i.find(".divWCRS341_Creation").css("display","block"),WCTD601.View.RaiseResize(i),WCTD601.View.RaiseUpdate(),!1}function l(t,r){var f=n(t.target).closest("li").find(i);return f.toggleClass("on"),g(r,f),u(r),t.preventDefault(),!1}function a(t,i){if(t.preventDefault(),n(".divWCRS341_MsgErreurListeExistante").addClass("masquer"),WCTD601.Validation.Valider(o+i.options.iCptControle)==!0){function u(n){var t=i.element.find("[id$="+n+"]").val();return t==""?null:t}var r={sNomListe:u("tbCreerListe"),sNoPointLivraison:i.options.sNoPointLivraison};d(i,r.sNomListe)==!0?f(i):WCTD601.Handler.AppelerViaJsonp({config:{url:i.options.sUrlHandlerCreerListe,xhrFields:{withCredentials:!0}},data:r,champErreurMapping:k(),formulaire:i.element,onChampSucces:function(n){v(n,i,r.sNomListe)}})}}function f(t){n(".divWCRS341_MsgErreurListeExistante").removeClass("masquer");t.element.find("[id$=tbCreerListe]").addClass("error").focus().WCTD203_Clear();WCTD601.View.RaiseResize(t.element)}function v(t,r,u){var s,h,o;t.objDonneesReponse!=null?(s={iIdListe:t.objDonneesReponse,iQuantiteArticles:0,sNom:u,fModifEffectuee:!0},h=e(s,r),WCRS341_AjoutDansListe.lstListeClient.push(s),r.element.find(".ulWCRS341_Listes").prepend(h),h.find(i).trigger("click"),r.element.find("[id$=tbCreerListe]").WCTD203_Clear(),WCTD601.View.RaiseResize(r.element),n(".pWCRS341_SousTitre1").removeClass("masquer"),n(".pWCRS341_SousTitre2").addClass("masquer"),o=r.element.find(".divWCRS341_Listes .jspScrollable"),o!=null&&o.length>0&&o.jScrollPane2({fScrollOut:!1}).data("jsp").scrollToY(0),r.element.find(".aWCRS341_ToggleCreation").css("display","block"),r.element.find(".divWCRS341_Creation").css("display","none")):f(r)}function y(r){if(r.options.fValiderEnabled==!0){var u=Array();r.element.find(".ulWCRS341_Listes li").each(function(){var t=n(this);u.push({iIdListeClient:t.find("input").val(),fContientElement:t.find(i).is(".on")})});WCTD601.Handler.AppelerViaJsonp({config:{url:r.options.sUrlHandlerAjoutDansListe,xhrFields:{withCredentials:!0}},data:{lstListeClientProduit:u,iIdElement:r.options.iIdElement,objProvenanceArticle:r.options.objProvenanceArticle,lstListesModifiees:t,sNoPointLivraison:r.options.sNoPointLivraison},champErreurMapping:{},formulaire:r.element,onChampSucces:function(n){p(n,r)}})}return!1}function p(n,t){var i,r,u,e,f,o;if(n.objDonneesReponse!=null&&(i=[],r=!1,t.options.eTypeElement==WCRS341_AjoutDansListe.enuTypeElement.iPRODUIT?(i.push(t.options.iIdElement),r=n.objDonneesReponse.fEstDansUneListe):t.options.eTypeElement==WCRS341_AjoutDansListe.enuTypeElement.iPANIER&&n.objDonneesReponse.length&&n.objDonneesReponse[0].sListeProduits&&(i=n.objDonneesReponse[0].sListeProduits.split(";"),r=!0),i&&i.length))for(u=0;u<i.length;u++)e=Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iLISTE_PRODUIT_MISE_A_JOUR).avecElement({sIdProduit:i[u],fEstDansUneListe:r}),Managers.jsWCRS609_MgrEvenement.emettreEvenement(e);f=t.options.eTypeElement==WCRS341_AjoutDansListe.enuTypeElement.iPANIER?n.objDonneesReponse:n.objDonneesReponse.objListeModifiee;f.length>0?(o=WCTD201.Class.PopinImageTexte,WCTD201.Class.PopinManager.FermerPopin("WCRS093_OuverturePopinAjoutDansListe"),o.Ouvrir({sNomPopin:"WCRS341_ConfirmationAjoutDansListe",urlImage:t.options.icoListeSucces,iLargeurImg:56,iHauteurImg:35,fFermerPopin:!1,texte:w(f,t),popinType:WCTD201.Class.PopinBulle,popin:{iDuree:5,sAssociatedControlId:t.options.sIdAncrePopinConfirmation,iOffsetX:WCRS341_AjoutDansListe.niOffsetX,iOffsetY:WCRS341_AjoutDansListe.niOffsetY,iOffsetFlecheY:WCRS341_AjoutDansListe.niOffsetFlecheY,PositionFleche:WCRS341_AjoutDansListe.sPositionFleche}})):WCTD201.Class.PopinManager.FermerPopin()}function w(t,i){for(var o=n("<div />").addClass("divWCRS341_MajListeSucces"),s=n("<h2 />").html(i.options.sTitreConf).addClass("policeBleu"),f,e,u=t.length==1?n("<p />").append(i.options.sLblListeMajSuccesSingulier):n("<p />").append(i.options.sLblListeMajSuccesPluriel),r=0;r<t.length;r++)f=n("<span />").html(" ("+t[r].iQuantite+")"),e=n("<strong />").append(t[r].sNomListe).append(f),u.append(e);return o.append(s).append(u)}function b(n){for(var i=n.options.lstListeClient,r=n.element.find(".ulWCRS341_Listes"),t=0;t<i.length;t++)r.append(e(i[t],n))}function e(t,i){var u="WCRS341_liste_"+t.iIdListe+"_"+i.options.iCptControle,s=n("<input />").attr("type","checkbox").attr("id",u).attr("value",t.iIdListe),f=n("<span />").addClass(r).append(s),e,o;return t.fContientElement==!0&&f.addClass("on"),e=n("<span />").html(" ("+t.iQuantiteArticles+")"),o=n("<label />").attr("for",u).append(t.sNom).append(e),n("<li />").append(f).append(o)}function k(){return{sNomListe:"valTbCreerListe"}}function d(n,t){for(var i=0;i<n.options.lstListeClient.length;i++)if(n.options.lstListeClient[i].sNom==t)return!0;return!1}function g(n,t){for(var r=!1,i=0;i<WCRS341_AjoutDansListe.lstListeClient.length;i++)WCRS341_AjoutDansListe.lstListeClient[i].iIdListe==t.find("input").val()&&(r=!0,WCRS341_AjoutDansListe.lstListeClient[i].fModifEffectuee=t.hasClass("on")?!WCRS341_AjoutDansListe.lstListeClient[i].fContientElement:WCRS341_AjoutDansListe.lstListeClient[i].fContientElement);n.options.fValiderEnabled=r?s():!0}function nt(){t=[]}var o="WCRS341_FormCreerListe",r="spanWCRS341_Checkbox",i="."+r,t=Array();window.WCRS341_AjoutDansListe={enuTypeElement:{iPRODUIT:0,iPANIER:1},niOffsetX:0,niOffsetY:0,sPositionFleche:WCTD201.Class.PopinBulle.enuPositionFleche.BOTTOM,lstListeClient:null,fReorientationPopinBulle:!0,sNoPointLivraison:null};window.WCRS341_OuvrirAjoutDansListe=function(n){var t;Utilitaires.Ressources.Page!=undefined&&(t=Utilitaires.Ressources.Page.PARAM_URL_EST_CONNECTE);WCTD601.Handler.AppelerViaJsonp({config:{url:t},onChampSucces:function(t){t.objDonneesReponse!=undefined?(n.niOffsetX===undefined&&(n.niOffsetX=0),n.niOffsetY===undefined&&(n.niOffsetY=0),n.niOffsetFlecheY===undefined&&(n.niOffsetFlecheY=0),(n.sPositionFleche===undefined||n.sPositionFleche.length==0)&&(n.sPositionFleche=WCTD201.Class.PopinBulle.enuPositionFleche.BOTTOM),(n.sTitre===undefined||n.sTitre.length==0)&&(n.sTitre=""),(n.iIdElement===undefined||n.iIdElement.length==0)&&(n.iIdElement=0),(n.fReorientationPopinBulle===undefined||n.fReorientationPopinBulle.length==0)&&(n.fReorientationPopinBulle=!0),WCRS341_AjoutDansListe.niOffsetX=n.niOffsetX,WCRS341_AjoutDansListe.niOffsetY=n.niOffsetY,WCRS341_AjoutDansListe.niOffsetFlecheY=n.niOffsetFlecheY,WCRS341_AjoutDansListe.sPositionFleche=n.sPositionFleche,WCRS341_AjoutDansListe.fReorientationPopinBulle=!0,WCRS341_AjoutDansListe.sNoPointLivraison=n.sNoPointLivraison,WCTD201.Class.PopinManager.OuvrirPopin({sNomPopin:"WCRS093_OuverturePopinAjoutDansListe",fFermerPopin:n.fFermerPopin,data:{sTitre:n.sTitre,eTypeElement:n.eTypeElement,iIdElement:n.iIdElement,sIdAncre:n.sIdAncre,niOffsetX:n.niOffsetX,niOffsetY:n.niOffsetY,niOffsetFlecheY:n.niOffsetFlecheY,sPositionFleche:n.sPositionFleche,fReorientationPopinBulle:n.fReorientationPopinBulle,sNoPointLivraison:n.sNoPointLivraison},popin:{sCssClassStyle:"divWCRS341_PopinAjoutListe"}})):WCTD201.Class.PopinManager.OuvrirPopin({sNomPopin:"WCLD027_OuverturePopinAuthentification",data:{sMessageHeader:n.sMsgHeaderPopinAuthen}})}})};Utilitaires.widget("infomil.widgAjoutDansListe",{options:{},_create:function(){var t,i;if(this._super("_create"),this.options.eTypeElement==WCRS341_AjoutDansListe.enuTypeElement.iPRODUIT&&(this.options.sTitreConf=this.element.find("h2").html()),this.options.fValiderEnabled=!1,WCRS341_AjoutDansListe.lstListeClient=this.options.lstListeClient,h(this),b(this),u(this),this.options.lstListeClient.length>0){for(n(".pWCRS341_SousTitre2").addClass("masquer"),t=!1,i=0;i<this.options.lstListeClient.length;i++)t=t||this.options.lstListeClient[i].fContientElement;t?(n(".pWCRS341_SousTitre1").addClass("masquer"),n(".pWCRS341_SousTitre3").removeClass("masquer")):(n(".pWCRS341_SousTitre1").removeClass("masquer"),n(".pWCRS341_SousTitre3").addClass("masquer"))}else n(".pWCRS341_SousTitre1").addClass("masquer"),n(".pWCRS341_SousTitre2").removeClass("masquer"),n(".pWCRS341_SousTitre3").addClass("masquer")},_destroy:function(){this._super("_destroy");nt()}})})(window.jQuery);typeof Sys!="undefined"&&Sys.Application.notifyScriptLoaded();