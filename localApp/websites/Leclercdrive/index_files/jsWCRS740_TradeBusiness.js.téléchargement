var debugLogConsole=function(n){window.localStorage&&window.localStorage.debug&&console.log(n+" - "+Date.now());window.localStorage&&window.localStorage.debug=="break"},Infomil=Infomil||{};Infomil.Api=Infomil.Api||{};Infomil.Api.Trade=Infomil.Api.Trade||{};Infomil.Api.Trade.Business=Infomil.Api.Trade.Business||{},function(){debugLogConsole(">>>> Infomil.Api.Trade.Business - CONSTRUCTEUR");this.sEVT_READY="sEvtTradeGeneriqueReady";this.AbonnerEvenementReady=function(n){$(Infomil.Api.Trade.Business).on(Infomil.Api.Trade.Business.sEVT_READY,n);Infomil.Api.Trade.Business.EvtReadyLeve&&n()};$(Infomil.Api.Trade.Business).on(Infomil.Api.Trade.Business.sEVT_READY,function(){Infomil.Api.Trade.Business.EvtReadyLeve=!0});this.TradeBusiness=function(n){var f=function(n){return n=n.toLowerCase(),n=n.replace(/é/gi,"e"),n=n.replace(/è/gi,"e"),n=n.replace(/ë/gi,"e"),n=n.replace(/ê/gi,"e"),n=n.replace(/à/gi,"a"),n=n.replace(/â/gi,"a"),n=n.replace(/[^a-z]/gi,""),n=n.replace(/ /gi,""),n.substr(0,10)},r,u;this.sIdTradeBusiness=f(n);debugLogConsole(">>>> Infomil.Api.Trade.Business.TradeBusiness - CONSTRUCTEUR");var e="OperationTG",o="jsWCRS740",t={GetNbProduits:function(){return(new Infomil.Api.Trade.Outils).GetNbProduits(window.TradeGeneriqueContext.Datasource)},GetProduitParID:function(n){var u,i,r;if(!window.TradeGeneriqueContext.Datasource)return null;for(u=t.GetNbProduits(window.TradeGeneriqueContext.Datasource),i=0;i<u;i++)if(r=window.TradeGeneriqueContext.Datasource[i].objElement,r.iIdProduit==n)return r.iIndexDansListe=i+1,r},VerifierParametresInvalides:function(n,t,i,r,u){try{if(n==Infomil.Api.Trade.Entite.enuTypeTrade.iTETE_GONDOLE&&!t)throw"190129093200 - niNbVignettesMin est obligatoire pour un trade de type 'iTETE_GONDOLE'";if(n==Infomil.Api.Trade.Entite.enuTypeTrade.iENCART_COEUR_DE_LISTE&&!t)throw"190129093201 - niNbVignettesMin est obligatoire pour un trade de type 'iENCART_COEUR_DE_LISTE'";if(i.GetPositionType()==Infomil.Api.Trade.Entite.sPOSITION_APRES_PRODUIT&&n!=Infomil.Api.Trade.Entite.enuTypeTrade.iENCART_COEUR_DE_LISTE)throw"190129093204 - Le positionnement 'Apres Produit' est réservé aux trades de type 'iENCART_COEUR_DE_LISTE'";if(i.GetPositionType()==Infomil.Api.Trade.Entite.sPOSITION_FIXE){if(!i.GetPosition().iLigne)throw"190129093205 - Le champs 'iLigne' est obligatoire pour le positionnement 'Position Fixe'";if(n==Infomil.Api.Trade.Entite.enuTypeTrade.iENCART_COEUR_DE_LISTE&&!i.GetPosition().niColonne)throw"190129093206 - le champ niColonne est obligatoire pour un trade de type 'iENCART_COEUR_DE_LISTE'";}}catch(f){u.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_PARAMETRES_INVALIDES,f,"VerifierParametresInvalides")}},VerifierLevierPlusPrioritaire:function(n){try{if(window.TradeGeneriqueContext.ListeBannieres)throw"190129093207 - Une banniere est présente sur la page";if(window.TradeGeneriqueContext.Trade)for(var t=0;t<window.TradeGeneriqueContext.Trade.length;t++)if(window.TradeGeneriqueContext.Trade[t].objElement.sType==e)throw"190129093208 - Une opération Tete de Gondole est présente sur la page";}catch(i){n.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_LEVIER_PLUS_PRIORITAIRE,i,"VerifierLevierPlusPrioritaire")}},VerifierPasAssezProduit:function(n,i){try{if(!window.TradeGeneriqueContext.Datasource)throw"190129093209 - TradeGeneriqueContext.Datasource non défini";var r=t.GetNbProduits();if(r<15&&n!=Infomil.Api.Trade.Entite.enuTypeTrade.iTETE_GONDOLE&&n!=Infomil.Api.Trade.Entite.enuTypeTrade.iBANDEAU_EN_TETE)throw"190129093210 - Il y a moins de 15 produits dans la page";}catch(u){i.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_PAS_ASSEZ_PRODUITS,u,"VerifierPasAssezProduit")}},VerifierMauvaisPositionnement:function(n,i,r,u){var f,e,l,s,h,a,c;try{if(n!=Infomil.Api.Trade.Entite.enuTypeTrade.iTETE_GONDOLE&&n!=Infomil.Api.Trade.Entite.enuTypeTrade.iENCART_COEUR_DE_LISTE)return;if(!r)throw"190129093211 - objPosition est indéfini";if(!i)throw"190129093212 - niNbVignettesMin est indéfini";if(!window.TradeGeneriqueContext.Colonnade)throw"190129093213 - TradeGeneriqueContext.Colonnade est indéfini";if(f=r.GetPosition(),e=window.TradeGeneriqueContext.Colonnade.getColonnade(),r.GetPositionType()==Infomil.Api.Trade.Entite.sPOSITION_FIXE&&(l=f.niColonne?f.niColonne:0,l+i-1>e.nb))throw{type:"iKO_MAUVAIS_POSITIONNEMENT",message:"1901301502 - Mauvais positionnement du trade (pas assez de place sur la ligne)"};if(r.GetPositionType()==Infomil.Api.Trade.Entite.sPOSITION_APRES_PRODUIT){if(s=f.iIdProduitRattachement,!s)throw"190129093214 - iIdProduitRattachement est indéfini";if(h=t.GetProduitParID(s),!h)throw"190129093215 - iIdProduitRattachement non trouvé";if(a=h.iIndexDansListe%e.nb,a+i-1>e.nb)throw{type:"iKO_MAUVAIS_POSITIONNEMENT",message:"1901301503 - Pas assez de place après le produit pour afficher le trade"};}}catch(o){c=Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_MAUVAIS_POSITIONNEMENT;o.type=="iKO_MAUVAIS_POSITIONNEMENT"&&(c=Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_MAUVAIS_POSITIONNEMENT);u.SetErreur(c,o.message?o.message:o,"VerifierMauvaisPositionnement")}},VerifierZoomableNecessaire:function(n,t){!n&&screen.width<1024&&t.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_ZOOMABLE_NECESSAIRE,"Le trade doit être zoomable pour être affiché","VerifierZoomableNecessaire")},VerifierPasAssezProduitPourLevier:function(n,i,r){var f,e;try{if(n!=Infomil.Api.Trade.Entite.enuTypeTrade.iENCART_COEUR_DE_LISTE)return;if(!window.TradeGeneriqueContext.Datasource)throw"190129093216 - TradeGeneriqueContext.Datasource est indéfini";if(!window.TradeGeneriqueContext.Colonnade)throw"190129093217 - TradeGeneriqueContext.Colonnade est indéfini";if(!i)throw"190129093218 - objPosition est indéfini";var u=i.GetPosition(),s=window.TradeGeneriqueContext.Colonnade.getColonnade(),o=(new Infomil.Api.Trade.Outils).GetNbProduits(window.TradeGeneriqueContext.Datasource);if(i.GetPositionType()==Infomil.Api.Trade.Entite.sPOSITION_FIXE){var h=u.niColonne?u.niColonne:0,c=u.iLigne?u.iLigne:0,l=s.nb*(c-1)+h;if(l>o)throw"190129093219 - Un trade de type 'iENCART_COEUR_DE_LISTE' ne peut pas être placé à la fin de la liste des produits";}if(i.GetPositionType()==Infomil.Api.Trade.Entite.sPOSITION_APRES_PRODUIT){if(f=u.iIdProduitRattachement,!f)throw"190131123400 - iIdProduitRattachement est indéfini";if(e=t.GetProduitParID(f),!e)throw"190131123401 - iIdProduitRattachement non trouvé";if(e.iIndexDansListe==o)throw"190131123402 - Un trade de type 'iENCART_COEUR_DE_LISTE' ne peut pas être positionné après le dernier produit de la liste";}}catch(a){r.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_PAS_ASSEZ_PRODUITS_POUR_CE_LEVIER,a,"VerifierPasAssezProduitPourLevier")}},VerifierEncartBandeauRayon:function(n,t,i){try{if(n==Infomil.Api.Trade.Entite.enuTypeTrade.iENCART_BANDEAU_RAYON){if(t.GetPositionType()!=Infomil.Api.Trade.Entite.sPOSITION_DANS_MENU_BANDEAU)throw"190401110100 - Un trade de type iENCART_BANDEAU_RAYON doit être positionné en sPOSITION_DANS_MENU_BANDEAU";var r=$("#"+t.GetPosition().sIdMenuBandeau);if(!r)throw"190401110104 - L'identifiant du menu bandeau est incorrect";}}catch(u){i.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_AUTRE,u,"VerifierEncartBandeauRayon")}}},i={VerifierCoherenceParametresInsertion:function(n,t){try{if(n.niNbVignettesMin&&n.niNbVignettesMax&&n.niNbVignettesMin>n.niNbVignettesMax)throw"1902251700 - Le nombre max de vignettes doit être > au nombre minimum.";if(n.niNbProduitsMin&&n.niNbProduitsMax&&n.niNbProduitsMin>n.niNbProduitsMax)throw"1902251701 - Le nombre max de produits doit être > au nombre minimum.";if(n.niNbVignettesMin&&n.niNbVignettesMin<0)throw"1902251702 - Le nombre minimum de vignettes doit être > 0";if(n.niNbVignettesMax&&n.niNbVignettesMax<0)throw"1902251703 - Le nombre maximum de vignettes doit être > 0";if(n.niNbProduitsMin&&n.niNbProduitsMin<0)throw"1902251704 - Le nombre minimum de produits doit être > 0";if(n.niNbProduitsMax&&n.niNbProduitsMax<0)throw"1902251705 - Le nombre maximum de produits doit être > 0";if(n.lstIdsProduits&&n.niNbProduitsMin&&n.lstIdsProduits.length<n.niNbProduitsMin)throw"1902251706 - Le nombre d'Id produits doit être >= au minimum demandé";if(n.objProprietesPageBoutique&&n.objProprietesPageBoutique.lstIdsProduit&&n.objProprietesPageBoutique.iNbProduitsMin&&n.objProprietesPageBoutique.lstIdsProduit.length<n.objProprietesPageBoutique.iNbProduitsMin)throw"1902251707 - Le nombre d'Id produits de la page boutique doit être >= au minimum demandé pour la page boutique";}catch(i){t.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_AUTRE,i,"InsertionLevier.VerifierCoherenceParametresInsertion")}},VerifierParametresInsertion:function(n,t){try{if(n.lstIdsProduits&&n.lstIdsProduits.push==null)throw"190129093220 - Le paramètre 'lstIdsProduit' est incorrect";if(!n.sIdOperation)throw"190129093221 - Le paramètre 'sIdOperation' est obligatoire";if(n.eTypeTrade==Infomil.Api.Trade.Entite.enuTypeTrade.iTETE_GONDOLE){if(!n.niNbVignettesMax)throw"190129093223 - Le paramètre 'niNbVignettesMax' est obligatoire pour le type de trade demandé";if(!n.niNbProduitsMin)throw"190129093224 - Le paramètre 'niNbProduitsMin' est obligatoire pour le type de trade demandé";if(!n.niNbProduitsMax)throw"190129093225 - Le paramètre 'niNbProduitsMax' est obligatoire pour le type de trade demandé";}if(n.objProprietesPageBoutique){if(!n.objProprietesPageBoutique.sIdOperation)throw"190129093226 - Le paramètre 'sIdOperation' est obligatoire pour objProprietesPageBoutique";if(!n.objProprietesPageBoutique.lstIdsProduit)throw"190129093227 - Le paramètre 'lstIdsProduit' est obligatoire pour objProprietesPageBoutique";if(!n.objProprietesPageBoutique.lstIdsProduit.push)throw"190129093228 - Le paramètre 'lstIdsProduit' est incorrect pour objProprietesPageBoutique";if(!n.objProprietesPageBoutique.iNbProduitsMin)throw"190129093229 - Le paramètre 'iNbProduitsMin' est obligatoire pour objProprietesPageBoutique";if(n.objProprietesPageBoutique.sIdOperation!=n.sIdOperation)throw"190129093230 - Les identifiants des opérations d'insertion et de la page boutique doivent être identiques";}}catch(i){t.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_AUTRE,i,"InsertionLevier.VerifierParametresInsertion")}}};this.DemanderAutorisationInsertionLevier=function(n,i,r,u){debugLogConsole(">>>> Infomil.Api.Trade.Business.TradeBusiness - DemanderAutorisationInsertionLevier");var f=new Infomil.Api.Trade.Entite.CRAutorisation(Infomil.Api.Trade.Entite.enuCRAutorisation.iOK,"","DemanderAutorisationInsertionLevier"),e=$.Deferred();try{if(!window.TradeGeneriqueContext)throw"190129093232 - TradeGeneriqueContext indéfini";if(!f.EstEnErreur()&&(t.VerifierEncartBandeauRayon(n,r,f),f.EstEnErreur()))return e.reject(f),e.promise();if(window.TradeGeneriqueContext.bModeBorne){if(!(new Infomil.Api.Trade.Outils).DemanderAutorisationModeBorne(n))throw"190212170230 - Insertion du trade impossible sur la page courante";return t.VerifierLevierPlusPrioritaire(f),f.EstEnErreur()?e.reject(f):e.resolve(f),e.promise()}if(!window.lstConfAjax.RecupererListeProduitsAjax)throw"190129093231 - Insertion d'un trade impossible sur la page courante";r||(r=new Infomil.Api.Trade.Entite.PositionFixe(1,1));f.EstEnErreur()||t.VerifierParametresInvalides(n,i,r,u,f);f.EstEnErreur()||t.VerifierLevierPlusPrioritaire(f);f.EstEnErreur()||t.VerifierPasAssezProduit(n,f);f.EstEnErreur()||t.VerifierMauvaisPositionnement(n,i,r,f);f.EstEnErreur()||t.VerifierZoomableNecessaire(u,f);f.EstEnErreur()||t.VerifierPasAssezProduitPourLevier(n,r,f);f.EstEnErreur()?e.reject(f):e.resolve(f)}catch(o){f.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_AUTRE,o,"DemanderAutorisationInsertionLevier");e.reject(f)}return e.promise()};window.TradeGeneriqueContext=window.TradeGeneriqueContext||{};window.TradeGeneriqueContext.objDeferred=window.TradeGeneriqueContext.objDeferred||{};window.TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness]=$.Deferred();r=function(n){var t,i;n.objElement.sIdTradeBusiness==this.sIdTradeBusiness&&(debugLogConsole(">>>> Infomil.Api.Trade.Business.TradeBusiness - INSERTION OK : "+JSON.stringify(n)),t=new Infomil.Api.Trade.Entite.CRInsertion,t.CRAutorisation.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iOK,n.objElement.sMessage,"InsererLevier"),i=$(".liWMKP001_TradeGenerique.liTrdGen_"+this.sIdTradeBusiness)[0],i&&(t.sIdBloc=i.id),TradeGeneriqueContext&&TradeGeneriqueContext.objRetourAjax&&TradeGeneriqueContext.objRetourAjax[this.sIdTradeBusiness]&&(new Infomil.Api.Trade.Outils).ConstruireCompteRenduInsertion(TradeGeneriqueContext.objRetourAjax[this.sIdTradeBusiness],t),t.sEVT_MAJ=t.sEVT_MAJ+"_"+this.sIdTradeBusiness,debugLogConsole(">>>> Infomil.Api.Trade.Business.TradeBusiness - trigger sEVT_MAJ - AVANT"),$(Infomil.Api.Trade.Business).trigger(t.sEVT_MAJ,t),debugLogConsole(">>>> Infomil.Api.Trade.Business.TradeBusiness - trigger sEVT_MAJ - APRES"),TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].resolve(t))};u=function(n){if(n.objElement.sIdTradeBusiness==this.sIdTradeBusiness){debugLogConsole(">>>> Infomil.Api.Trade.Business.TradeBusiness - INSERTION ERREUR : "+JSON.stringify(n));var t=new Infomil.Api.Trade.Entite.CRInsertion;t.CRAutorisation.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_AUTRE,n.objElement.sMessage,"InsererLevier");TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].reject(t)}};this.InsererLevier=function(n,t,f,e,s,h,c,l,a,v){var p,y,w;return(debugLogConsole(">>>> Infomil.Api.Trade.Business.TradeBusiness - InsererLevier"),p=new Infomil.Api.Trade.Entite.CRInsertion,e||(e=new Infomil.Api.Trade.Entite.PositionFixe(1,1)),v&&(v.sIdTradeBusiness=this.sIdTradeBusiness),y={sIdTradeBusiness:this.sIdTradeBusiness,eTypeTrade:n,sIdOperation:t,objPosition:e?e.GetPosition():null,fZoomable:s,niNbVignettesMin:f,niNbVignettesMax:h,niNbProduitsMin:c,niNbProduitsMax:l,lstIdsProduits:a,objProprietesPageBoutique:v},y.eTypeTrade==Infomil.Api.Trade.Entite.enuTypeTrade.iENCART_BANDEAU_RAYON)?((new Infomil.Api.Trade.Outils).InsererEncartBandeauRayon(y,TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness]),TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].promise()):y.eTypeTrade==Infomil.Api.Trade.Entite.enuTypeTrade.iENCART_MODE_BORNE?((new Infomil.Api.Trade.Outils).InsererEncartModeBorne(y,TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness]),TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].promise()):y.eTypeTrade==Infomil.Api.Trade.Entite.enuTypeTrade.iENCART_FILTRES?((new Infomil.Api.Trade.Outils).InsererEncartFiltres(y,TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness]),TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].promise()):window.TradeGeneriqueContext.bModeBorne?(this.DemanderAutorisationInsertionLevier(n,f,e,s).done(function(n){if(p.CRAutorisation=n,p.CRAutorisation.sContexteErreur="InsererLevier (Mode Borne)",p.CRAutorisation.EstEnErreur()){TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness].reject(p);return}return(new Infomil.Api.Trade.Outils).InsererTradeModeBorne(y,TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness]),TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness].promise()}).fail(function(n){p.CRAutorisation=n;TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness].reject(p);return}),TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].promise()):y.eTypeTrade==Infomil.Api.Trade.Entite.enuTypeTrade.iBANDEAU_FIXE_PIED?((new Infomil.Api.Trade.Outils).InsererBandeauFixePied(y,TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness]),TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].promise()):(y.eTypeTrade==Infomil.Api.Trade.Entite.enuTypeTrade.iTETE_GONDOLE&&y.objPosition&&(y.objPosition.niColonne=1,window.TradeGeneriqueContext.Colonnade&&(w=window.TradeGeneriqueContext.Colonnade.getColonnade().nb,y.niNbProduitsMax=w)),y.eTypeTrade==Infomil.Api.Trade.Entite.enuTypeTrade.iBANDEAU_EN_TETE&&y.objPosition&&(y.objPosition.niColonne=1),window.TradeGeneriqueContext.paramInsertionLevier=window.TradeGeneriqueContext.paramInsertionLevier||{},window.TradeGeneriqueContext.paramInsertionLevier[this.sIdTradeBusiness]=y,i.VerifierCoherenceParametresInsertion(y,p.CRAutorisation),p.CRAutorisation.EstEnErreur()?TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].reject(p):(Managers.jsWCRS609_MgrEvenement.abonnerEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iAJOUT_TRADE_GENERIQUE_OK,r,this),Managers.jsWCRS609_MgrEvenement.abonnerEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iAJOUT_TRADE_GENERIQUE_ERREUR,u,this),this.DemanderAutorisationInsertionLevier(n,f,e,s).done(function(n){var r,u,f;if(p.CRAutorisation=n,p.CRAutorisation.sContexteErreur="InsererLevier",p.CRAutorisation.EstEnErreur()){TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].reject(p);return}if(i.VerifierParametresInsertion(y,p.CRAutorisation),p.CRAutorisation.EstEnErreur()){TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness].reject(p);return}if(r={sIdAppelant:o,sIdOperation:t,niNbProduitsMin:c,niNbProduitsMax:l,lstIdsProduits:a,objProprietesPageBoutique:v},!r.lstIdsProduits){window.TradeGeneriqueContext.objRetourAjax=window.TradeGeneriqueContext.objRetourAjax||{};window.TradeGeneriqueContext.objRetourAjax[y.sIdTradeBusiness]={Context:r,Message:"",Contenu:{objContenuElement:{objElement:{sType:"TradeGeneriqueSTO",sId:"TradeGeneriqueSTO999",sUrlImgEnteteTradeGen:"",sTexteAlternatifImgTradeGen:"Trade Generique",sIdUnique:"TradeGeneriqueSTO999"},lstEnfants:[]},lstProduit:[],objStickers:{lstProduitsStickers:[],lstStickers:[]}}};Managers.jsWCRS609_MgrEvenement.emettreEvenement(Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iAJOUT_TRADE_GENERIQUE).avecElement({sIdTradeBusiness:y.sIdTradeBusiness}));return}if(u=window.lstConfAjax.RecupererListeProduitsAjax,u)Utilitaires.Ajax.appeler({context:null,config:u,data:r}).done(function(n){if(n.Message!=""){window.TradeGeneriqueContext.objRetourAjax=window.TradeGeneriqueContext.objRetourAjax||{};window.TradeGeneriqueContext.objRetourAjax[y.sIdTradeBusiness]=null;p.CRAutorisation.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_AUTRE,n.Message,"InsererLevier");TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness].reject(p);return}window.TradeGeneriqueContext.objRetourAjax=window.TradeGeneriqueContext.objRetourAjax||{};window.TradeGeneriqueContext.objRetourAjax[y.sIdTradeBusiness]=n;Managers.jsWCRS609_MgrEvenement.emettreEvenement(Interfaces.jsWCRS642_ItfEvenement.avecTypeEvenement(Interfaces.jsWCRS642_ItfEvenement.enuTypeEvenementClient.iAJOUT_TRADE_GENERIQUE).avecElement({sIdTradeBusiness:y.sIdTradeBusiness}))}).fail(function(n){window.TradeGeneriqueContext.objRetourAjax=window.TradeGeneriqueContext.objRetourAjax||{};window.TradeGeneriqueContext.objRetourAjax[y.sIdTradeBusiness]=null;p.CRAutorisation.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_AUTRE,"Erreur Ajax : "+n.responseText,"InsererLevier");TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness].reject(p);return});else{f="190129093233 - Erreur lors de la récupération du trade (erreur configuration Ajax - RecupererListeProduitsAjax)";p.CRAutorisation.SetErreur(Infomil.Api.Trade.Entite.enuCRAutorisation.iKO_AUTRE,f,"InsererLevier");TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness].reject(p);return}}).fail(function(n){p.CRAutorisation=n;TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness].reject(p);return})),TradeGeneriqueContext.objDeferred[y.sIdTradeBusiness].promise())};this.RecupererProprietesPageBoutique=function(){if(debugLogConsole(">>>> Infomil.Api.Trade.Business.TradeBusiness - RecupererProprietesPageBoutique"),TradeGeneriqueContext&&TradeGeneriqueContext.InformationsPageBoutique)if(TradeGeneriqueContext.InformationsPageBoutique.sIdTradeBusiness!=this.sIdTradeBusiness)TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].reject("190522115732 - Erreur : L'identifiant TradeBusiness n'est pas correct.");else{var n=new Infomil.Api.Trade.Entite.ProprietesPageBoutique(TradeGeneriqueContext.InformationsPageBoutique.sIdOperation,TradeGeneriqueContext.InformationsPageBoutique.sTitrePage,TradeGeneriqueContext.InformationsPageBoutique.sListeProduits.split(","),TradeGeneriqueContext.InformationsPageBoutique.iNbProduitsMin,TradeGeneriqueContext.InformationsPageBoutique.sIdTradeBusiness);TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].resolve(n)}else TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].reject("190522115735 - Erreur : Aucune page boutique détectée.");return TradeGeneriqueContext.objDeferred[this.sIdTradeBusiness].promise()}}}.call(Infomil.Api.Trade.Business);